{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { effect } from \"./effect\";\nexport { reactive } from \"./reactive\";\n", "export let activeEffect = undefined; // \u5F53\u524D\u6B63\u5728\u6267\u884C\u7684effect\n\nclass ReactiveEffect {\n  public active = true; // \u6FC0\u6D3B\u72B6\u6001\n  public parent = null; // \u7236\u7C7B\n  public deps = []; // effect \u4E2D\u7528\u4E86\u54EA\u4E9B\u5C5E\u6027\uFF0C\u540E\u7EED\u6E05\u7406\u7684\u65F6\u5019\u8981\u4F7F\u7528\n  constructor(public fn) {} // \u7B49\u4EF7\u4E8E this.fn = fn\n  // \u4F9D\u8D56\u6536\u96C6 \u8BA9\u719F\u6089\u548C effect \u4EA7\u751F\u5173\u7CFB\n  run() {\n    // \u5982\u679C\u6CA1\u6709\u6FC0\u6D3B\n    if (!this.active) {\n      return this.fn();\n    } else {\n      try {\n        // \u6BCF\u6B21\u6267\u884C\u5C31\u63A5\u53D7 this\n        this.parent = activeEffect;\n        activeEffect = this;\n        //  \u53BB proyx\u5BF9\u8C61\u53D6\u503C,\u53D6\u81F3\u7684\u65F6\u5019,\u8981\u8BA9\u8FD9\u4E2A\u719F\u6089 \u548C\u5F53\u524D\u7684 effect\u51FD\u6570\u5173\u8054\u8D77\u6765,\u7A0D\u540E\u6570\u636E\u53D8\u5316\u4E86,\u53EF\u4EE5\u91CD\u65B0\u6267\u884C effect \u51FD\u6570\n        return this.fn();\n      } finally {\n        // \u6267\u884C\u5B8C\u6BD5\u540E\u8FD8\u539FactiveEffect,\u53D6\u6D88\u5F53\u524D\u6B63\u5728\u8FD0\u884C\u7684activeEffect\n        activeEffect = undefined;\n        this.parent = null;\n      }\n    }\n  }\n}\n\nexport function effect(fn) {\n  // \u5C06\u7528\u6237\u4F20\u9012\u7684\u51FD\u6570\u7F16\u7A0B\u54CD\u5E94\u5F0F\u7684 effect\n  const _effect = new ReactiveEffect(fn); // \u521B\u5EFA\u54CD\u5E94\u5F0Feffect\n  _effect.run(); // \u8BA9\u54CD\u5E94\u5F0Feffect\u9ED8\u8BA4\u6267\u884C\n}\n\n// \u54EA\u4E2A\u5BF9\u8C61\u4E2D\u7684\u90A3\u4E2A \u5C5E\u6027 \u5BF9\u5E94\u7684\u90A3\u4E00\u4E2A effect\n// \u4E00\u4E2A\u5C5E\u6027\u5BF9\u5E94\u591A\u4E2A effect\n// \u5916\u5C42\u7528\u4E00\u4E2A map {object:{name:[effect,effect],age:[effect,effect]}}\n\n// \u5C06\u5C5E\u6027\u548C\u5BF9\u5E94\u7684effect\u7EF4\u62A4\u6210\u6620\u5C04\u5173\u7CFB\uFF0C\u540E\u7EED\u5C5E\u6027\u53D8\u5316\u53EF\u4EE5\u89E6\u53D1\u5BF9\u5E94\u7684effect\u51FD\u6570\u91CD\u65B0run\n\nconst targetMap = new WeakMap(); // \u8BB0\u5F55\u4F9D\u8D56\u5173\u7CFB\n\n// \u8BA9\u6570\u636E\u8BB0\u5F55\u6240\u5728\u7684effect \u662F\u8C01 \uFF0C\u54EA\u4E2A effect \u5BF9\u5E94\u4E86\u54EA\u4E9B\u5C5E\u6027\nexport function track(traget, key) {\n  if (activeEffect) {\n    // \u5982\u679C\u6709\u4E2AactiveEffect\u7684\u5B9E\u4F8B\uFF0C\u624D\u505A\u4F9D\u8D56\u6536\u96C6\n    let depMap = targetMap.get(traget); // {\u5BF9\u8C61\uFF1Amap}\n    if (!depMap) {\n      // \u5982\u679C\u6CA1\u6709\u5BF9\u8C61\u5C5E\u6027\uFF0C\u5C31\u521B\u5EFA\u4E00\u4E2A\n      targetMap.set(traget, (depMap = new Map()));\n    }\n\n    // \u83B7\u53D6\u5C5E\u6027\n    let deps = depMap.get(key);\n    if (!deps) {\n      depMap.set(key, (deps = new Set())); // {\u5BF9\u8C61\uFF1A{ \u5C5E\u6027 :[ dep, dep ]}}\n    }\n\n    // \u83B7\u53D6\u5C5E\u6027\u7684\u6307\u5411\n    let shouldTrack = !deps.has(activeEffect); // \u662F\u5426\u9700\u8981\u6536\u96C6\n    if (shouldTrack) {\n      deps.add(activeEffect); // \u5C06\u6307\u5411\u653E\u5165\n      activeEffect.deps.push(deps); // \u8BA9effect\u8BB0\u4F4Fdep\uFF0C\u8FD9\u6837\u540E\u7EED\u53EF\u4EE5\u7528\u4E8E\u6E05\u7406\n    }\n  }\n  console.log(activeEffect, targetMap);\n  // console.log(traget, key, activeEffect);\n}\n\n/*\nactiveEffect = e1\n\neffect(()=>{ // e1\n    state.name; // name = e1\n    effect(()=>{ // e2\n      state.age; // name = e2\n    })\n    \u5982\u679C\u6267\u884C\u7684\u8BDD\uFF0C\u5C31\u4F1A\u5168\u5C40\u8BB0\u5F55\u4E4B\u540E\uFF0C\u91CA\u653E\n    state.address; // address = undefined\n})\n\n*/\n\n/*\n\u5982\u4F55\u89E3\u51B3\u91CA\u653E\u7684\u95EE\u9898?\n\nactiveEffect = e1\n\neffect(()=>{ // e1  e1.parent = null \n    state.name; // name = e1\n    effect(()=>{ // e2  e2.parent = e1\n      state.age; // name = e2\n    })\n\n    // \u6267\u884C\u4E4B\u540E\u5462\uFF0C\u628A\u7236\u8282\u70B9\u8FD8\u539F\n    activeEffect = e2.parent\n    state.address; // address = e1\n})\n*/\n", "export const isObject = (value) => {\n    return typeof value === 'object' && value != null\n}", "import { track } from \"./effect\";\n// v8\u7684\u5783\u573E\u56DE\u6536\u673A\u5236 \u6807\u8BB0\u5220\u9664 \u5F15\u7528\u8BA1\u6570\nexport const enum ReactiveFlags {\n  IS_REACTIVE = \"__v_isReactive\", // \u6807\u8BB0\u4E00\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61\n}\n\nexport const baseHandler = {\n  // \u76EE\u6807\u5BF9\u8C61\uFF0C\u88AB\u83B7\u53D6\u7684\u5C5E\u6027\u540D\uFF0CProxy \u6216\u8005\u7EE7\u627F Proxy \u7684\u5BF9\u8C61\n  get(traget, key, receiver) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      // \u5982\u679C\u5DF2\u7ECF\u4EE3\u7406\u8FC7\u4E86\u5C31\u76F4\u63A5\u8FD4\u56DE\uFF0C\u4E0D\u518D\u4EE3\u7406\u4E86\n      return true;\n    }\n\n    // \u8BA9\u5F53\u524D\u7684 key \u548C effect \u5173\u8054\u8D77\u6765\n    // \u5C5E\u6027\u53D8\u4E86\uFF0C\u5E0C\u671B\u91CD\u65B0\u6267\u884C\u6E32\u67D3\n    track(traget, key);\n    // console.log(\"\u53EF\u4EE5\u8BB0\u5F55\u8FD9\u4E2A\u5C5E\u6027\u7528\u4E86\u90A3\u4E2A effect\");\n    // console.log(activeEffect);\n    return Reflect.get(traget, key, receiver);\n  },\n  set(traget, key, value, receiver) {\n    // console.log(\"\u8FD9\u4E2A\u53EF\u4EE5\u901A\u77E5 effect \u91CD\u65B0\u6267\u884C\");\n    return Reflect.set(traget, key, value, receiver);\n  },\n};\n", "import { isObject } from \"@vue/shared\";\n// \u83B7\u53D6effect\u7684\u5B9E\u4F8B\nimport { ReactiveFlags, baseHandler } from \"./baseHandler\";\n\nconst reactiveMap = new WeakMap(); // \u5FC5\u987B\u662F\u5BF9\u8C61\uFF0C\u5F31\u5F15\u7528\n\nexport function reactive(traget) {\n  if (!isObject(traget)) {\n    return traget;\n  }\n\n  // es6 \u4E2D\u7684 proxy\n  // \u52A0\u5165\u6807\u8BC6\n  if (traget[ReactiveFlags.IS_REACTIVE]) {\n    return traget;\n  }\n\n  const existing = reactiveMap.get(traget);\n  // \u662F\u5426\u5B58\u5728\u8FC7\n  if (existing) {\n    return existing;\n  }\n\n  // \u5C06\u7ED1\u5B9A\u7684\u65B9\u6CD5\u62C6\u5206\u81F3 baseHandler\n  const proxy = new Proxy(traget, baseHandler);\n  reactiveMap.set(traget, proxy);\n  return proxy;\n}\n\n// \u95EE\u9898 1 \u5982\u679C\u51FA\u73B0 get \u6570\u636E\u52AB\u6301\n// let preson = {\n//   name: \"zf\",\n//   get allName() {\n//     return this.name + \"all\";\n//   },\n// };\n// \u4F7F\u7528 proxy \u8981\u642D\u914D Reflect \u6765\u4F7F\u7528\n\n// \u95EE\u9898 2 \u5982\u679C\u4E24\u4E2A obj \u5BFC\u5165\n// const state1 = reactive(obj)\n// const state2 = reactive(state1)\n// \u4E00\u4E2A\u5BF9\u8C61\u5DF2\u7ECF\u88AB\u4EE3\u7406\u8FC7\u4E86\uFF0C\u5C31\u4E0D\u8981\u518D\u6B21\u4EE3\u7406\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAO,MAAI,eAAe;AAE1B,MAAM,iBAAN,MAAqB;AAAA,IAInB,YAAmB,IAAI;AAAJ;AAHnB,WAAO,SAAS;AAChB,WAAO,SAAS;AAChB,WAAO,OAAO,CAAC;AAAA,IACS;AAAA,IAExB,MAAM;AAEJ,UAAI,CAAC,KAAK,QAAQ;AAChB,eAAO,KAAK,GAAG;AAAA,MACjB,OAAO;AACL,YAAI;AAEF,eAAK,SAAS;AACd,yBAAe;AAEf,iBAAO,KAAK,GAAG;AAAA,QACjB,UAAE;AAEA,yBAAe;AACf,eAAK,SAAS;AAAA,QAChB;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEO,kBAAgB,IAAI;AAEzB,UAAM,UAAU,IAAI,eAAe,EAAE;AACrC,YAAQ,IAAI;AAAA,EACd;AAQA,MAAM,YAAY,oBAAI,QAAQ;AAGvB,iBAAe,QAAQ,KAAK;AACjC,QAAI,cAAc;AAEhB,UAAI,SAAS,UAAU,IAAI,MAAM;AACjC,UAAI,CAAC,QAAQ;AAEX,kBAAU,IAAI,QAAS,SAAS,oBAAI,IAAI,CAAE;AAAA,MAC5C;AAGA,UAAI,OAAO,OAAO,IAAI,GAAG;AACzB,UAAI,CAAC,MAAM;AACT,eAAO,IAAI,KAAM,OAAO,oBAAI,IAAI,CAAE;AAAA,MACpC;AAGA,UAAI,cAAc,CAAC,KAAK,IAAI,YAAY;AACxC,UAAI,aAAa;AACf,aAAK,IAAI,YAAY;AACrB,qBAAa,KAAK,KAAK,IAAI;AAAA,MAC7B;AAAA,IACF;AACA,YAAQ,IAAI,cAAc,SAAS;AAAA,EAErC;;;ACnEO,MAAM,WAAW,CAAC,UAAU;AAC/B,WAAO,OAAO,UAAU,YAAY,SAAS;AAAA,EACjD;;;ACIO,MAAM,cAAc;AAAA,IAEzB,IAAI,QAAQ,KAAK,UAAU;AACzB,UAAI,QAAQ,oCAA2B;AAErC,eAAO;AAAA,MACT;AAIA,YAAM,QAAQ,GAAG;AAGjB,aAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,IAC1C;AAAA,IACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAEhC,aAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAAA,IACjD;AAAA,EACF;;;ACrBA,MAAM,cAAc,oBAAI,QAAQ;AAEzB,oBAAkB,QAAQ;AAC/B,QAAI,CAAC,SAAS,MAAM,GAAG;AACrB,aAAO;AAAA,IACT;AAIA,QAAI,OAAO,qCAA4B;AACrC,aAAO;AAAA,IACT;AAEA,UAAM,WAAW,YAAY,IAAI,MAAM;AAEvC,QAAI,UAAU;AACZ,aAAO;AAAA,IACT;AAGA,UAAM,QAAQ,IAAI,MAAM,QAAQ,WAAW;AAC3C,gBAAY,IAAI,QAAQ,KAAK;AAC7B,WAAO;AAAA,EACT;",
  "names": []
}
