{
  "version": 3,
  "sources": ["../src/effect.ts", "../../shared/src/index.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export let activeEffect = undefined; // \u5F53\u524D\u6B63\u5728\u6267\u884C\u7684effect\n\nexport class ReactiveEffect {\n  // \u9ED8\u8BA4\u5C06 fn \u6302\u8F7D\u5230\u7C7B\u7684\u5B9E\u4F8B\u4E0A\n  constructor(private fn) {}\n  parent = undefined;\n\n  run() {\n    try {\n      this.parent = activeEffect;\n      activeEffect = this;\n      return this.fn();\n    } finally {\n      // \u6267\u884C\u5B8C\u6BD5\u540E\u8FD8\u539FactiveEffect,\u53D6\u6D88\u5F53\u524D\u6B63\u5728\u8FD0\u884C\u7684activeEffect\n      activeEffect = this.parent;\n      this.parent = undefined;\n    }\n  }\n}\n\nexport function effect(fn) {\n  // \u521B\u5EFA\u4E00\u4E2A\u54CD\u5E94\u5F0F effect\uFF0C\u5E76\u4E14\u8BA9 effect \u6267\u884C\n  const _effect = new ReactiveEffect(fn);\n  _effect.run();\n}\n\n// weackmap: map\n// {name:'jw' }:'name' -> [effect,effect]\n//             : 'age' -> [effect]\nconst targetMap = new WeakMap();\nexport function track(target, key) {\n  // \u8BA9\u8FD9\u4E2A\u5BF9\u8C61\u4E0A\u7684\u5C5E\u6027 \u8BB0\u5F55\u5F53\u524D\u7684 activeEffect\n  if (activeEffect) {\n    // \u8BF4\u660E\u7528\u6237\u662F\u5728effect\u4E2D\u4F7F\u7528\u7684\u8FD9\u4E2A\u6570\u636E\n    let depsMap = targetMap.get(target);\n\n    // \u5982\u679C\u6CA1\u6709\u521B\u5EFA\u4E00\u4E2A\u6620\u5C04\u8868\n    if (!depsMap) {\n      targetMap.set(target, (depsMap = new Map()));\n    }\n    // \u5982\u679C\u6709\u8FD9\u4E2A\u6620\u5C04\u8868\u6765\u67E5\u627E\u4E00\u4E0B\u6709\u6CA1\u6709\u8FD9\u4E2A\u5C5E\u6027\n    let dep = depsMap.get(key);\n\n    // \u5982\u679C\u6CA1\u6709set\u96C6\u5408\u521B\u5EFA\u96C6\u5408\n    if (!dep) {\n      depsMap.set(key, (dep = new Set()));\n    }\n    // \u5982\u679C\u6709\u5219\u770B\u4E00\u4E0Bset\u4E2D\u6709\u6CA1\u6709\u8FD9\u4E2Aeffect\n    let shouldTrack = !dep.has(activeEffect);\n    if (shouldTrack) {\n      dep.add(activeEffect);\n\n      // name = new Set(effect)\n      // age = new Set(effect)\n\n      // \u6211\u53EF\u4EE5\u901A\u8FC7\u5F53\u524D\u7684effect \u627E\u5230\u8FD9\u4E24\u4E2A\u96C6\u5408\u4E2D\u7684\u81EA\u5DF1\u3002\u5C06\u5176\u79FB\u9664\u6389\u5C31\u53EF\u4EE5\u4E86\n      activeEffect.deps.push(dep);\n    }\n  }\n}\n\nexport function trigger(traget, key, newVal) {\n  // \u901A\u8FC7\u5BF9\u8C61\u627E\u5230\u5BF9\u5E94\u7684\u5C5E\u6027 \u8BA9\u8FD9\u4E2A\u5C5E\u6027\u5BF9\u5E94\u7684 effect \u91CD\u65B0\u6267\u884C\n}\n\n// activeEffect = e1\n// e2.parent = e1\n", "export const isObject = (value) => {\n    return typeof value === 'object' && value != null\n}", "/*\n * @Author: Mason\n * @Date: 2023-01-20 08:58:08\n * @LastEditors: Mason\n * @LastEditTime: 2023-01-20 09:21:02\n * @FilePath: /vue-core/packages/reactivity/src/baseHandler.ts\n */\nimport { track } from \"./effect\";\n// v8\u7684\u5783\u573E\u56DE\u6536\u673A\u5236 \u6807\u8BB0\u5220\u9664 \u5F15\u7528\u8BA1\u6570\nexport const enum ReactiveFlags {\n  IS_REACTIVE = \"__v_isReactive\", // \u6807\u8BB0\u4E00\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61\n}\n\nexport const baseHandler = {\n  // \u76EE\u6807\u5BF9\u8C61\uFF0C\u88AB\u83B7\u53D6\u7684\u5C5E\u6027\u540D\uFF0CProxy \u6216\u8005\u7EE7\u627F Proxy \u7684\u5BF9\u8C61\n  get(traget, key, receiver) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      // \u5982\u679C\u5DF2\u7ECF\u4EE3\u7406\u8FC7\u4E86\u5C31\u76F4\u63A5\u8FD4\u56DE\uFF0C\u4E0D\u518D\u4EE3\u7406\u4E86\n      return true;\n    }\n\n    // \u505A\u4F9D\u8D56\u6536\u96C6 \u8BB0\u5F55\u5C5E\u6027\u548C\u5F53\u524D effect \u7684\u5173\u7CFB\n    // \u8BA9\u5F53\u524D\u7684 key \u548C effect \u5173\u8054\u8D77\u6765\n    // \u5C5E\u6027\u53D8\u4E86\uFF0C\u5E0C\u671B\u91CD\u65B0\u6267\u884C\u6E32\u67D3\n    track(traget, key);\n\n    // console.log(\"\u53EF\u4EE5\u8BB0\u5F55\u8FD9\u4E2A\u5C5E\u6027\u7528\u4E86\u90A3\u4E2A effect\");\n    // console.log(activeEffect);\n    return Reflect.get(traget, key, receiver);\n  },\n  set(traget, key, value, receiver) {\n    let oldValue = traget[key];\n\n    // console.log(\"\u8FD9\u4E2A\u53EF\u4EE5\u901A\u77E5 effect \u91CD\u65B0\u6267\u884C\");\n    const r = Reflect.set(traget, key, value, receiver);\n\n    if (oldValue !== value) {\n      trigger(traget, key, value);\n    }\n\n    return r;\n  },\n};\n", "import { isObject } from \"@vue/shared\";\n// \u83B7\u53D6effect\u7684\u5B9E\u4F8B\nimport { ReactiveFlags, baseHandler } from \"./baseHandler\";\n\nconst reactiveMap = new WeakMap(); // \u5FC5\u987B\u662F\u5BF9\u8C61\uFF0C\u5F31\u5F15\u7528\n\nexport function reactive(traget) {\n  if (!isObject(traget)) {\n    return traget;\n  }\n\n  // es6 \u4E2D\u7684 proxy\n  // \u52A0\u5165\u6807\u8BC6\n  if (traget[ReactiveFlags.IS_REACTIVE]) {\n    return traget;\n  }\n\n  const existing = reactiveMap.get(traget);\n  // \u662F\u5426\u5B58\u5728\u8FC7\n  if (existing) {\n    return existing;\n  }\n\n  // \u5C06\u7ED1\u5B9A\u7684\u65B9\u6CD5\u62C6\u5206\u81F3 baseHandler\n  const proxy = new Proxy(traget, baseHandler);\n  reactiveMap.set(traget, proxy);\n  return proxy;\n}\n\n// \u95EE\u9898 1 \u5982\u679C\u51FA\u73B0 get \u6570\u636E\u52AB\u6301\n// let preson = {\n//   name: \"zf\",\n//   get allName() {\n//     return this.name + \"all\";\n//   },\n// };\n// \u4F7F\u7528 proxy \u8981\u642D\u914D Reflect \u6765\u4F7F\u7528\n\n// \u95EE\u9898 2 \u5982\u679C\u4E24\u4E2A obj \u5BFC\u5165\n// const state1 = reactive(obj)\n// const state2 = reactive(state1)\n// \u4E00\u4E2A\u5BF9\u8C61\u5DF2\u7ECF\u88AB\u4EE3\u7406\u8FC7\u4E86\uFF0C\u5C31\u4E0D\u8981\u518D\u6B21\u4EE3\u7406\n"],
  "mappings": ";AAAO,IAAI,eAAe;AAEnB,IAAM,iBAAN,MAAqB;AAAA,EAE1B,YAAoB,IAAI;AAAJ;AACpB,kBAAS;AAAA,EADgB;AAAA,EAGzB,MAAM;AACJ,QAAI;AACF,WAAK,SAAS;AACd,qBAAe;AACf,aAAO,KAAK,GAAG;AAAA,IACjB,UAAE;AAEA,qBAAe,KAAK;AACpB,WAAK,SAAS;AAAA,IAChB;AAAA,EACF;AACF;AAEO,gBAAgB,IAAI;AAEzB,QAAM,UAAU,IAAI,eAAe,EAAE;AACrC,UAAQ,IAAI;AACd;AAKA,IAAM,YAAY,oBAAI,QAAQ;AACvB,eAAe,QAAQ,KAAK;AAEjC,MAAI,cAAc;AAEhB,QAAI,UAAU,UAAU,IAAI,MAAM;AAGlC,QAAI,CAAC,SAAS;AACZ,gBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,IAC7C;AAEA,QAAI,MAAM,QAAQ,IAAI,GAAG;AAGzB,QAAI,CAAC,KAAK;AACR,cAAQ,IAAI,KAAM,MAAM,oBAAI,IAAI,CAAE;AAAA,IACpC;AAEA,QAAI,cAAc,CAAC,IAAI,IAAI,YAAY;AACvC,QAAI,aAAa;AACf,UAAI,IAAI,YAAY;AAMpB,mBAAa,KAAK,KAAK,GAAG;AAAA,IAC5B;AAAA,EACF;AACF;;;AC3DO,IAAM,WAAW,CAAC,UAAU;AAC/B,SAAO,OAAO,UAAU,YAAY,SAAS;AACjD;;;ACWO,IAAM,cAAc;AAAA,EAEzB,IAAI,QAAQ,KAAK,UAAU;AACzB,QAAI,QAAQ,oCAA2B;AAErC,aAAO;AAAA,IACT;AAKA,UAAM,QAAQ,GAAG;AAIjB,WAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,EAC1C;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAChC,QAAI,WAAW,OAAO;AAGtB,UAAM,IAAI,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAElD,QAAI,aAAa,OAAO;AACtB,cAAQ,QAAQ,KAAK,KAAK;AAAA,IAC5B;AAEA,WAAO;AAAA,EACT;AACF;;;ACtCA,IAAM,cAAc,oBAAI,QAAQ;AAEzB,kBAAkB,QAAQ;AAC/B,MAAI,CAAC,SAAS,MAAM,GAAG;AACrB,WAAO;AAAA,EACT;AAIA,MAAI,OAAO,qCAA4B;AACrC,WAAO;AAAA,EACT;AAEA,QAAM,WAAW,YAAY,IAAI,MAAM;AAEvC,MAAI,UAAU;AACZ,WAAO;AAAA,EACT;AAGA,QAAM,QAAQ,IAAI,MAAM,QAAQ,WAAW;AAC3C,cAAY,IAAI,QAAQ,KAAK;AAC7B,SAAO;AACT;",
  "names": []
}
